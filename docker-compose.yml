version: '3'

networks: 
  app-origo:

services: 

    laravel-api-origo:
      image: laravel-api-origo
      container_name: origo-laravel
      build: 
        context: .
        dockerfile: laravel.dockerfile
      volumes:
        - ./src:/var/www/html
        - ./php/xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini
        -  /var/www/html/vendor # to not share node_modules
      ports: 
        - 8000:8000
      networks: 
        - app-origo
      
      command: php artisan serve --host 0.0.0.0

    postgres-db-origo:
      container_name: dborigo-postgres
      image: postgres-db-origo
      build: 
        context: .
        dockerfile: postgres.dockerfile
      restart: always
      environment: 
        POSTGRES_PASSWORD: password
        # POSTGRES_HOST_AUTH_METHOD: 0.0.0.0/0
      ports:
        - 5433:5432
      volumes:
        - ./postgres/conf.d/my-postgres.conf:/etc/postgresql/postgresql.conf # set configuations
        - ./postgres/data:/var/lib/postgresql/data #store data
        - ./postgres/scripts:/docker-entrypoint-initdb.d # run scripts inmediatly
      networks: 
        - app-origo

    angular-origo:
      image: angular-origo
      container_name: origo-frontend
      build: 
        context: .
        dockerfile: angular.dockerfile
      ports:
        - 4200:4200
      volumes:
        - ./src/app-frontend:/usr/app

      command: ash -c "npm install -y && ng serve --host 0.0.0.0" # For DEV 

      networks: 
        - app-origo

      # command: tail -f /dev/null # keep open container 